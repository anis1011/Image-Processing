
import cv2
import numpy as np
import time
import os
import glob
import sys
workingFolder, filename = os.path.split(os.path.abspath(__file__))

def main():
  
    inputImages = []
    logImages = []
    inputFolder = workingFolder +"/images/input/*.jpg"
    logsFolder = workingFolder + "/images/logs/*.jpg"

    files = glob.glob(workingFolder +"/images/logs/*") #clear logs folder
    for f in files:
        os.remove(f)

    for file in glob.glob(inputFolder):
        inputImages.append(file)


    index = 0
    if (len(inputImages) > 0):
        for path in inputImages:
            try:
                index += 1

                # hardcoded values to crop image, x, y are left corners where cropping starts 
                #x = 333
                #y = 177
                #h = 24
                #w = 134

                img = cv2.imread(path)
              #  img = img[y:y+h, x:x+w]
                              
                inverted_img = cv2.bitwise_not(img)

                cv2.rectangle(inverted_img, (0, 0), (640, 177), (255,255,255), cv2.FILLED)
                cv2.rectangle(inverted_img, (0, 203), (640, 480), (255,255,255), cv2.FILLED)

                cv2.rectangle(inverted_img, (0, 176), (332, 480), (255,255,255), cv2.FILLED)
                cv2.rectangle(inverted_img, (465, 176), (640, 480), (255,255,255), cv2.FILLED)
                cv2.imwrite(workingFolder +'/images/logs/cropped-%s.jpg' %index ,inverted_img)  

                path =workingFolder + "/images/logs/cropped-1.jpg" 
                cmd ="tesseract" +path +" ./process_txt &wait; cat ./process_txt.txt"
                os.system(cmd)
				sys.stdout.flush()				
              
            except Exception as e: 
                print(e)
				sys.stdout.flush()

        for file in glob.glob(logsFolder):
            logImages.append(file)

        """  if (len(logImages) > 0):
            for path in logImages:
                finalImg = cv2.imread(path)  
              
        else:
            print("No images found on logs folder")     """     
    else:
        print("No images found on input folder")
		sys.stdout.flush()

if __name__=='__main__':
    main()
   	
